==========================================
PIPEX DEFENSE TESTS (Simple & Clear)
==========================================


# ------------------------------------------
# Prepare input file
# ------------------------------------------

echo "one\ntwo\nthree\nfour\nthree\none\n" > infile


# ==========================================
# TEST 1 — Simple pipeline
# Count how many lines contain "one"
# ==========================================

# Shell command
< infile grep one | wc -l > out_shell

# Pipex command
./pipex infile "grep one" "wc -l" out_pipex

# Compare results
diff -u out_shell out_pipex && echo "OK"


# ==========================================
# TEST 2 — Commands with flags
# Sort lines then count unique occurrences
# ==========================================

# Shell command
< infile sort | uniq -c > out_shell

# Pipex command
./pipex infile "sort" "uniq -c" out_pipex

# Compare results
diff -u out_shell out_pipex && echo "OK"


# ==========================================
# TEST 3 — Larger input
# Shows pipe works with more data
# ==========================================

seq 1 5000 > infile_big

# Shell command
< infile_big grep 4999 | wc -l > out_shell

# Pipex command
./pipex infile_big "grep 4999" "wc -l" out_pipex

# Compare results
diff -u out_shell out_pipex && echo "OK"


# ==========================================
# TEST 4 — Missing input file (error test)
# Program should print error and exit
# ==========================================

./pipex nofile "cat" "wc -l" out
echo Exit status: $?


# ==========================================
# TEST 5 — Command not found (error test)
# ==========================================

./pipex infile "notacommand" "wc -l" out
echo Exit status: $?


# ==========================================
# TEST 6 — Permission error on output
# ==========================================

touch locked
chmod 000 locked

./pipex infile "cat" "wc -l" locked
echo Exit status: $?

chmod 644 locked


# ==========================================
# TEST 7 — No hanging pipes
# Program should finish immediately
# ==========================================

printf "hello\n" > infile2

./pipex infile2 "cat" "cat" out_pipex
echo DONE


# ==========================================
# TEST 8 — No extra output
# Should print nothing on success
# ==========================================

./pipex infile "grep three" "wc -l" out_pipex
